/* eslint-disable class-methods-use-this */
const Redis = require("ioredis");
const util = require("util");

let redisService = null;

class RedisService {
	constructor() {
		this.client = new Redis(
			process.env.REDIS_PORT,
			process.env.REDIS_HOST
		);
		this.getAsync = util.promisify(this.client.get).bind(this.client);
		this.setAsync = util.promisify(this.client.set).bind(this.client);
	}

	async setScanId(id, scanId) {
		await this.client.set(id, scanId);
	}
}

function getRedisService() {
	if (!redisService) {
		redisService = new RedisService();
		Object.freeze(redisService);
	}
	return redisService;
}

module.exports = getRedisService;
